<!DOCTYPE html>
<html>

<head lang="en">
    <meta charset="UTF-8">

    <title>Easing</title>
    <meta name="description" content="l'easing permet de varier la manière dont on interpole entre deux valeurs">
    <meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover">

</head>

<body>

    <script src="../base.js"></script>
    <script src="../geom.js"></script>
    <script src="../graphics.js"></script>
    <script src="../utils/Easing.js"></script>
    <script>

        var G = new Graphics(ctx);
        function draw() {

            requestAnimationFrame(draw);
            ctx.clearRect(0, 0, w, h);

            // on sotcke les valeurs des coins (gauche/droite/haut/bas)

            let left = 100
            let right = w - 100
            let top = 100
            let bottom = h - 100
            let width = w - 200
            let height = h - 200

            //calcule une variable d'oscillation
            var T = .5 + Math.sin(performance.now() * 0.001) * .5;

            //choisit une formule d'easing 
            var fc = Easing[easingName];

            //écrit le nom de l'easing en haut à gauche
            ctx.fillStyle = "#000";
            G.text(easingName, 12, 100, 90);
            ctx.strokeRect(top, left, width, height);

            //dessine une barre verticale sous X
            var x = lerp(T, left, right);
            G.line(x, top, x, bottom);
            G.disc(x, top, 5);


            //calcule la valeur d'easing à T
            var E = fc(T)

            /*
            E est compris entre 0 et 1 
            on interpole la valeur de E entre le bas et le haut
            */
            var y = lerp(E, bottom, top);
            ctx.fillStyle = "#F00";
            G.disc(x, y, 5)

            return

            /*
            pour mieux voir on peut dessiner la courbe entière 
            */
            ctx.beginPath();
            for (var i = 0; i <= 1; i += .01) {

                var y = Math.max(0, Math.min(1, fc(i)));
                ctx.lineTo(lerp(i, 100, w - 100), lerp(y, h - 100, 100));

            }
            ctx.lineTo(w - 100, 100);
            ctx.stroke();

            return

            //on peut également représenter la variation sous forme de rectangle 
            ctx.fillRect(w - 75, bottom, 20, - ( E * height ) );

            //ou de disque
            G.disc(w / 2, bottom + 50, E * 30);

        }

        var easingId = -1;
        var easingName = "";
        function onMouseDown(e) {

            easingId++;
            easingId %= 21;
            var id = 0;
            for (var key in Easing) {
                if (id++ != easingId) continue;
                easingName = key;
            }

        }
        canvas.addEventListener('mousedown', onMouseDown, false);
        onMouseDown();
        draw();

    </script>
</body>

</html>